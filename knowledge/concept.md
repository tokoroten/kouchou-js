## 概要

このアプリケーションは、Talk to the city、広聴AIをJS単体で動作するように再実装したものです。

https://github.com/AIObjectives/talk-to-the-city-reports
https://github.com/digitaldemocracy2030/kouchou-ai

ブラウザ上のアプリとして動作し、サーバを不要にすることで、ポータビリティとセキュリティの向上を図っています。

## 技術スタックを使用

- TypeScript、node20
- React
- Zustand
- OpenAI API
- IndexedDB
- UMAP
  - https://www.npmjs.com/package/umap-js
- K-meansクラスタリング
- plotly.js
- Webworker
- Tailwind css
- ESLint
- Prettier

## アプリケーションの動作の流れ

- 新しい分析の開始
  - UUIDが払い出され、セッションが開始される
  - このUUIDは、indexedDBに保存され、アプリケーションの状態を管理するために使用される
  - 複数のセッションを同時に管理できるようにする

- ユーザがCSVファイルをアップロード
  - アップロードされたファイルはindexedDBに保存される
  - CSVは、解析対象となる意見と、発言者の属性情報を含む

- 発言の成形
  - LLM(OpenAIのAPI)を使用して、意見を抽出・成形する
  - これにより、一つの意見の中に複数の意見が含まれる場合に適切に分割される
  - 成形によって、後段のエンベデッディングで結果がブレにくくなる

- 意見のエンベデッディング
  - 成形された意見を、OpenAIのAPIを使用してエンベデッディングする
  - エンベデッディングされた意見は、後段の可視化や分類に使用される

- UMAPによる低次元写像
  - エンベデッディングされたベクトルをUMAPを使用して2次元に写像する
  - これにより、意見の分布を視覚的に理解しやすくする
  - 他の分析セッションから、学習済みのUMAPのモデルを再利用することも可能
    - これにより、同じデータセットに対して一貫した可視化が可能になる
    - インクリメンタルにデータが増えた場合でも、既存のモデルを使用して新しいデータを追加することができる

- k-meansによるクラスタリング
  - UMAPで2次元に写像された意見を、K-meansクラスタリングを使用して分類する
  - クラスタリングされた意見は、後段の可視化に使用される
  - クラスタ数は、ユーザが設定可能

- 意見の表札化と要約、全体の要約
  - クラスタの中から、n個の意見を選び、それらを包括する概念を生成してクラスタの名前にし、またクラスタの要約を生成する
    - クラスタの重心に最も近い点を1つ選ぶ
    - 次に、既存の標本から最も遠い点を選ぶ
    - これをn回繰り返し、クラスタ全体から均質に標本する
  - 各クラスタの要約を受け取り、全体の要約を生成する
    - 全体の要約は、クラスタの要約を統合して生成される

- 結果の可視化
  - plotly.jsを使用して、意見の分布を2次元平面上に可視化する
  - クラスタごとに色分けし、意見の多様性を視覚的に表現する
  - クラスタの重心には、クラスタの名前を表示する
  - 全体の要約、各クラスタの要約を分かりやすくHTMLで表示する

- 結果のexport
   - HTMLとして出力し、HTML単体で閲覧可能な形式にする
   - CSV形式で出力し、他のアプリケーションで利用可能にする

## webworkerの活用

Webworkerを使用して、以下の処理を非同期で実行します。
- CSVファイルの解析
- LLMを使用した意見の成形
- エンベデッディングの計算
- UMAPによる低次元写像
- K-meansクラスタリング
- 意見の表札化

それぞれのステップが終了するごとに、indexedDBに結果を保存し、UIに反映します。
## 画面構成

- アップロード画面
  - CSVファイルをアップロードするためのインターフェース
  - アップロードされたファイルのプレビュー表示

- 設定画面
  - LLMのAPIキーの設定
  - エンベデッディングやクラスタリングのパラメータ設定

